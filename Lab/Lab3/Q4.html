<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Tasmania Web GIS â€” OpenLayers + WMS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v10.6.1/ol.css">
  <style>
    /* Keep it simple: guarantee the map has height */
    html, body { height: 100%; margin: 0; }
    header { padding: 12px; border-bottom: 1px solid #e5e5e5; font-family: system-ui, Arial, sans-serif; }
    #map { width: 100%; height: calc(100% - 110px); }
    .panel { font-family: system-ui, Arial, sans-serif; padding: 8px 12px; }
    .panel label { margin-right: 14px; }
  </style>
</head>
<body>
  <header>
    <h3>Lab3: Web-based Mapping Using OpenLayers</h3>
    <h4>Author: Ian Kresak</h4>
  </header>

  <div class="panel">
    <strong>Overlays:</strong>
    <label><input type="checkbox" id="chkCar" checked> Carriageways</label>
    <label><input type="checkbox" id="chkCad" checked> Cadastre</label>
    <label><input type="checkbox" id="chkBus" checked> Bus Trips</label>
  </div>

  <div id="map"></div>

  <script src="https://cdn.jsdelivr.net/npm/ol@v10.6.1/dist/ol.js"></script>
  <script>
    // --- 1) Basemap (OSM) ---
    const osm = new ol.layer.Tile({
      title: 'OpenStreetMap',
      source: new ol.source.OSM()
    });

    // --- 2) WMS Overlays (Tasmania GeoServer) ---
    // If tiles don't appear, check devtools console for CORS/network errors.
    const wmsUrl = 'https://data.stategrowth.tas.gov.au/geoserver/ows';

    const carriageways = new ol.layer.Tile({
      title: 'Road Carriageways (ssg:GEO_CARRIAGEWAY)',
      visible: true,
      opacity: 1,
      source: new ol.source.TileWMS({
        url: wmsUrl,
        params: {
          LAYERS: 'ssg:GEO_CARRIAGEWAY',
          TILED: true,
          FORMAT: 'image/png',
          TRANSPARENT: true
        },
        serverType: 'geoserver',
        transition: 0
      })
    });

    const cadastre = new ol.layer.Tile({
      title: 'Cadastre Parcels (pam:GEO_CADASTRE)',
      visible: true,
      opacity: 0.7,
      source: new ol.source.TileWMS({
        url: wmsUrl,
        params: {
          LAYERS: 'pam:GEO_CADASTRE',
          TILED: true,
          FORMAT: 'image/png',
          TRANSPARENT: true
        },
        serverType: 'geoserver',
        transition: 0
      })
    });

    const busTrips = new ol.layer.Tile({
      title: 'Bus Trips (ssg:GEO_BRM_TRIP)',
      visible: true,
      opacity: 1,
      source: new ol.source.TileWMS({
        url: wmsUrl,
        params: {
          LAYERS: 'ssg:GEO_BRM_TRIP',
          TILED: true,
          FORMAT: 'image/png',
          TRANSPARENT: true
        },
        serverType: 'geoserver',
        transition: 0
      })
    });

    // --- 3) Map + View (Tasmania extent) ---
    const tasExtent4326 = [144.0, -44.2, 149.0, -39.0]; // rough TAS bbox
    const tasExtent3857 = ol.proj.transformExtent(tasExtent4326, 'EPSG:4326', 'EPSG:3857');

    const map = new ol.Map({
      target: 'map',
      layers: [osm, carriageways, cadastre, busTrips],
      view: new ol.View({
        projection: 'EPSG:3857',
        center: ol.extent.getCenter(tasExtent3857),
        zoom: 7
      })
    });

    // Fit once the map is ready
    map.once('postrender', () => {
      map.getView().fit(tasExtent3857, { size: map.getSize(), padding: [20,20,20,20], duration: 400 });
    });

    // --- 4) Simple toggles (no external plugins required) ---
    document.getElementById('chkCar').addEventListener('change', (e) => carriageways.setVisible(e.target.checked));
    document.getElementById('chkCad').addEventListener('change', (e) => cadastre.setVisible(e.target.checked));
    document.getElementById('chkBus').addEventListener('change', (e) => busTrips.setVisible(e.target.checked));

    // --- 5) Helpful debugging (logs if WMS tiles fail to load) ---
    [carriageways, cadastre, busTrips].forEach(layer => {
      layer.getSource().on('tileloaderror', () => {
        console.warn('WMS tile failed to load for layer:', layer.get('title'));
      });
    });
  </script>
</body>
</html>
