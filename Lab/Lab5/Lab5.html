<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OpenLayers Basemap Switcher + WMS (USA Centered)</title>
  <!-- OpenLayers CSS & JS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v10.6.1/ol.css" />
  <script src="https://cdn.jsdelivr.net/npm/ol@v10.6.1/dist/ol.js"></script>
  <style>
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; background:#f7f7fb; color:#111; }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 16px; }
    h1 { font-size: 22px; margin: 0 0 8px; }
    p.small { margin: 0 0 12px; font-size: 14px; color:#444; }
    .panel { display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom: 12px; }
    .card { background:#fff; border:1px solid #e5e7eb; border-radius: 14px; padding: 12px; box-shadow: 0 1px 6px rgba(0,0,0,0.06); }
    #map { width: 100%; height: 70vh; border-radius: 16px; border:1px solid #e5e7eb; box-shadow: 0 2px 10px rgba(0,0,0,0.05); overflow:hidden; }
    .foot { margin-top: 8px; font-size: 12px; color:#666; }
    @media (max-width: 800px) { .panel { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>OpenLayers Map: Basemap Switcher + WMS</h1>
    <p class="small">Basemaps: OpenStreetMap or Esri World Imagery. Overlay: GeoServer WMS (<code>topp:states</code>).</p>

    <!-- Controls -->
    <div class="panel">
      <div class="card">
        <div class="label" style="font-weight:600; margin-bottom:6px;">Basemap</div>
        <label style="display:inline-flex; align-items:center; gap:8px; margin-right:18px; cursor:pointer;">
          <input type="radio" name="basemap" value="osm" checked />
          <span>OSM (Streets)</span>
        </label>
        <label style="display:inline-flex; align-items:center; gap:8px; cursor:pointer;">
          <input type="radio" name="basemap" value="esri" />
          <span>Esri Imagery</span>
        </label>
      </div>

      <div class="card">
        <div class="label" style="font-weight:600; margin-bottom:6px;">Overlays</div>
        <label style="display:inline-flex; align-items:center; gap:8px; cursor:pointer;">
          <input id="wmsToggle" type="checkbox" checked />
          <span>WMS: topp:states</span>
        </label>
      </div>
    </div>

    <!-- Map container -->
    <div id="map"></div>

    <div class="foot">
      © OpenStreetMap contributors. Esri World Imagery © Esri, Maxar, Earthstar Geographics, and the GIS User Community. WMS courtesy of <a href="https://ahocevar.com/geoserver" target="_blank" rel="noreferrer">ahocevar.com GeoServer</a> (layer: topp:states).
    </div>
  </div>

  <script>
    // --- Base layers ---
    const osm = new ol.layer.Tile({
      source: new ol.source.OSM(),
      visible: true
    });

    const esriImagery = new ol.layer.Tile({
      source: new ol.source.XYZ({
        url: 'https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
        attributions: [
          'Tiles © Esri — Source: Esri, Maxar, Earthstar Geographics, and the GIS User Community'
        ]
      }),
      visible: false
    });

    // --- WMS overlay (topp:states) ---
    const wmsStates = new ol.layer.Tile({
      source: new ol.source.TileWMS({
        url: 'https://ahocevar.com/geoserver/wms',
        params: {
          LAYERS: 'topp:states',
          TILED: true,
          VERSION: '1.1.1',
          FORMAT: 'image/png',
          SRS: 'EPSG:4326'
        },
        transition: 0
      }),
      visible: true,
      opacity: 0.9
    });

    // --- Map ---
    const map = new ol.Map({
      target: 'map',
      layers: [osm, esriImagery, wmsStates],
      view: new ol.View({
        center: ol.proj.fromLonLat([-98.583, 39.833]), // Continental US approx center
        zoom: 4,
        minZoom: 2,
        maxZoom: 19
      })
    });

    // --- UI Wiring ---
    document.querySelectorAll('input[name="basemap"]').forEach(r => {
      r.addEventListener('change', (e) => {
        const which = e.target.value;
        osm.setVisible(which === 'osm');
        esriImagery.setVisible(which === 'esri');
      });
    });

    document.getElementById('wmsToggle').addEventListener('change', (e) => {
      wmsStates.setVisible(e.target.checked);
    });

    // Maintain map size on container resize
    const observer = new ResizeObserver(() => map.updateSize());
    observer.observe(document.getElementById('map'));
  </script>
</body>
</html>
